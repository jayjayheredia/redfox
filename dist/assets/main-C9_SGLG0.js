import{d as f}from"./firebase-config-DQH0Qggq.js";import{collection as h,query as y,where as v,getDocs as u,addDoc as E}from"https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";import"https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js";import"https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";document.addEventListener("DOMContentLoaded",async function(){const d=document.getElementById("calendar"),a=h(f,"turnos"),p=async()=>(await u(a)).docs.map(e=>{const t=e.data();return{title:`${t.title} (${t.status})`,start:t.start,color:t.status==="pendiente"?"#facc15":"#22c55e"}}),s=new window.FullCalendar.Calendar(d,{initialView:"dayGridMonth",locale:"es",selectable:!0,events:await p(),dateClick:async function(n){const{value:e}=await Swal.fire({title:`Nuevo turno para el ${n.dateStr}`,html:'<label class="swal-label">Seleccione la hora:</label><input id="swal-input-time" type="time" class="swal2-input"><input id="swal-input-name" placeholder="Nombre completo" class="swal2-input"><input id="swal-input-phone" placeholder="Teléfono" class="swal2-input">',focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Reservar",cancelButtonText:"Cancelar",preConfirm:()=>{const r=document.getElementById("swal-input-time").value,c=document.getElementById("swal-input-name").value,i=document.getElementById("swal-input-phone").value;return!r||!c||!i?(Swal.showValidationMessage("Por favor completa todos los campos"),!1):{time:r,name:c,phone:i}}});if(!e)return;const{time:t,name:l,phone:m}=e,o=`${n.dateStr}T${t}:00`,w=y(a,v("start","==",o));if(!(await u(w)).empty)return Swal.fire("Error","Este horario ya está ocupado","error");try{await E(a,{title:l,start:o,phone:m,status:"pendiente"}),s.addEvent({title:`${l} (pendiente)`,start:o,color:"#facc15"}),Swal.fire("¡Éxito!","Turno solicitado correctamente","success")}catch{Swal.fire("Error","No se pudo guardar el turno","error")}}});s.render()});
